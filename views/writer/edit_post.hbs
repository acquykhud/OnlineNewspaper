<script src="https://cdn.ckeditor.com/4.9.1/standard/ckeditor.js"></script>
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h3>Chỉnh sửa bài viết</h3>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <form method="POST" action="../edit-post">
                <div class="form-group">
                    <label for="title">Tiêu đề</label>
                    <input type="text" class="form-control" id="title" name="title" value="{{article.title}}">
                </div>
                <div class="form-group">
                    <span class="d-none" id="old-subcategory-id">{{article.subcategory_id}}</span>
                    <label for="category">Chuyên mục</label>
                    <select id="category" class="form-control" name="subcategory_id">
                        <option value="" disabled hidden>Chọn chuyên mục</option>
                        {{!-- <optgroup label="Kinh doanh">
                            <option value="oranges1">Nông sản</option>
                            <option value="oranges2">Hải sản</option>
                            <option value="oranges3">Vĩ mô</option>
                        </optgroup> --}}
                    </select>
                </div>
                <div class="form-group">
                    <label for="abstract">Tóm tắt</label>
                    <textarea class="form-control" id="abstract" name="abstract">{{article.abstract}}</textarea>
                </div>
                <div class="form-group">
                    <label for="content">Nội dung</label>
                    <textarea name="content" id="content" name="content" class="form-control">{{article.content}}</textarea>
                    <script>
                        CKEDITOR.replace('content');
                    </script>
                </div>
                <div class="form-group">
                    <label for="tags">Gán nhãn</label>
                    <input type="text" class="form-control" id="tags" name="tags" data-role="tagsinput">
                    <p class="text-muted">Chú ý: Phân biệt các nhãn bằng cách enter</p>
                </div>
                <div class="form-group d-none">
                    <input type="text" readonly class="form-control" id="article-id"
                        name="article_id" value="{{article_id}}">
                </div>
                <center> <button type="submit" class="btn btn-primary"><i class="fa fa-save"></i> Lưu thay đổi</button>
                </center>
            </form>
        </div>
    </div>
</div>

{{#section 'js'}}
<script>
    async function createSelect() {
        await $.getJSON('/ajax/get-category-list', async function (catList) {
            for (const cat of catList) {
                $('#category').append(`<optgroup label="${cat.category_name}" id="cat${cat.category_id}"></optgroup>`);
                await $.getJSON(`/ajax/get-subcategory-list?catid=${cat.category_id}`, function (subcatList) {
                    for (const subcat of subcatList) {
                        $(`#cat${cat.category_id}`).append(`<option id="subcat${subcat.subcategory_id}" value="${subcat.subcategory_id}">${subcat.subcategory_name}</option>`);
                    }
                })
            }
        })

        const old_subcategory_id = $('#old-subcategory-id').html();
        $(`subcat${old_subcategory_id}`).attr('selected', 'selected');
    }

    createSelect();

    const article_id = +$('#article-id').val();
    $.getJSON(`/ajax/get-tag-list?artid=${article_id}`, function (tagList) {
        for (const tag of tagList) {
            $('#tags').tagsinput('add', tag);
        }
    });
</script>
{{/section}}